var PRESETS=[{id:"context7",name:"Context7 MCP",description:"取得最新的程式庫文件與範例程式碼，提升 AI 程式碼生成品質",config:{type:"stdio",command:"npx",args:["-y","@upstash/context7-mcp"],tools:["*"]}},{id:"brave-search",name:"Brave Search MCP",description:"網路搜尋功能，使用 Brave Search API",config:{type:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-brave-search"],env:{BRAVE_API_KEY:"<YOUR_API_KEY>"},tools:["*"]}},{id:"sqlite",name:"SQLite MCP",description:"SQLite 資料庫操作",config:{type:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-sqlite","/path/to/database.db"],tools:["*"]}},{id:"puppeteer",name:"Puppeteer MCP",description:"另一個瀏覽器自動化工具，基於 Chrome",config:{type:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-puppeteer"],tools:["*"]}},{id:"memory",name:"Memory MCP",description:"持久化記憶，跨對話保存資訊",config:{type:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-memory"],tools:["*"]}},{id:"playwright",name:"Playwright MCP",description:'瀏覽器自動化工具，可用於網頁測試和互動 (<a href="https://github.com/microsoft/playwright-mcp" target="_blank" rel="noopener noreferrer">官方 Repo</a>)',config:{type:"stdio",command:"npx",args:["@playwright/mcp@latest","--viewport-size","1280x720","--allowed-hosts","*"],tools:["*"]}},{id:"sequential-thinking",name:"Sequential Thinking MCP",description:"增強推理能力，支援複雜思考過程",config:{type:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-sequential-thinking"],tools:["*"]}}],selectedPresets=new Set,customConfigs=[],presetOverrides={},editingCustomId=null,editingPresetId=null;function escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function setFooterVersion(){const e=document.getElementById("appVersion");if(!e)return;const t=document.querySelector('meta[name="app-version"]'),o=t?.getAttribute("content")?.trim();o&&"dev"!==o?(e.textContent=`v${o}`,e.hidden=!1):e.hidden=!0}function init(){setFooterVersion(),loadState(),renderPresets(),renderCustomConfigs(),updateJsonOutput()}function loadState(){const e=localStorage.getItem("mcpConfig");if(e)try{const t=JSON.parse(e);selectedPresets=new Set(t.selectedPresets||[]),customConfigs=t.customConfigs||[],presetOverrides=t.presetOverrides||{}}catch(e){console.error("Failed to load saved state:",e)}}function saveState(){const e={selectedPresets:Array.from(selectedPresets),customConfigs:customConfigs,presetOverrides:presetOverrides};localStorage.setItem("mcpConfig",JSON.stringify(e))}function renderPresets(){const e=document.getElementById("presetList");e&&(e.innerHTML=PRESETS.map(e=>`\n        <div class="preset-item ${selectedPresets.has(e.id)?"selected":""}" id="preset-${e.id}">\n            <div class="preset-header">\n                <input type="checkbox" ${selectedPresets.has(e.id)?"checked":""} onclick="event.stopPropagation(); togglePreset('${e.id}')">\n                <span class="preset-name" onclick="togglePreset('${e.id}')">${e.name}</span>\n                <div class="preset-actions">\n                    <button class="small secondary" onclick="event.stopPropagation(); editPreset('${e.id}')">⚙️ 設定</button>\n                </div>\n            </div>\n            <div class="preset-description">${e.description}</div>\n        </div>\n    `).join(""))}function renderCustomConfigs(){const e=document.getElementById("customList");e&&(0!==customConfigs.length?e.innerHTML=customConfigs.map((e,t)=>`\n        <div class="custom-item">\n            <div class="custom-item-info">\n                <div class="custom-item-name">${escapeHtml(e.name)}</div>\n                ${e.description?`<div style="font-size: 0.9em; color: #666;">${escapeHtml(e.description)}</div>`:""}\n            </div>\n            <div class="custom-item-actions">\n                <button class="small secondary" onclick="editCustom(${t})">編輯</button>\n                <button class="small danger" onclick="deleteCustom(${t})">刪除</button>\n            </div>\n        </div>\n    `).join(""):e.innerHTML='<div class="empty-state">尚無自訂設定</div>')}function updateJsonOutput(){const e={};selectedPresets.forEach(t=>{const o=PRESETS.find(e=>e.id===t);if(o){const n=presetOverrides[t]||o.config;e[o.id]=n}}),customConfigs.forEach(t=>{e[t.name]=t.config});const t={mcpServers:e},o=document.getElementById("jsonOutput");o&&(o.value=JSON.stringify(t,null,2))}function stableStringify(e){if(null===e||"object"!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return"["+e.map(stableStringify).join(",")+"]";return"{"+Object.keys(e).sort().map(t=>JSON.stringify(t)+":"+stableStringify(e[t])).join(",")+"}"}function applyStateFromJsonText(e){const t=JSON.parse(e);if(!t.mcpServers||"object"!=typeof t.mcpServers||Array.isArray(t.mcpServers))throw new Error("JSON 必須包含 mcpServers 物件");selectedPresets.clear(),presetOverrides={},customConfigs=[];for(const[e,o]of Object.entries(t.mcpServers)){const t=PRESETS.find(t=>t.id===e);t?(selectedPresets.add(e),stableStringify(o)!==stableStringify(t.config)&&(presetOverrides[e]=o)):customConfigs.push({name:e,description:"",config:o})}}function closeCustomModal(){const e=document.getElementById("customModal"),t=document.getElementById("customName"),o=document.getElementById("customDescription");e&&e.classList.remove("show"),editingCustomId=null,editingPresetId=null,t&&(t.disabled=!1),o&&(o.disabled=!1)}function isCustomModalOpen(){const e=document.getElementById("customModal");return!!e&&e.classList.contains("show")}function saveCustomModal(){const e=document.getElementById("customForm");e&&("function"!=typeof e.requestSubmit?e.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})):e.requestSubmit())}function buildConfigFromForm(){const e=document.querySelector('input[name="connectionType"]:checked'),t=e?.value||"stdio",o={type:t},n=document.getElementById("stdioCommand"),s=document.getElementById("stdioArgs"),r=document.getElementById("stdioEnv"),i=document.getElementById("httpUrl"),c=document.getElementById("httpHeaders"),d=document.getElementById("sseUrl"),a=document.getElementById("sseHeaders"),l=document.getElementById("customTools");try{if("stdio"===t){if(o.command=n?.value.trim()||"",!o.command)throw new Error("命令欄位不可為空");const e=s?.value.trim()||"";o.args=e?e.split("\n").map(e=>e.trim()).filter(e=>e):[];const t=r?.value.trim()||"";t&&(o.env=JSON.parse(t))}else if("http"===t){if(o.url=i?.value.trim()||"",!o.url)throw new Error("URL 欄位不可為空");const e=c?.value.trim()||"";e&&(o.headers=JSON.parse(e))}else if("sse"===t){if(o.url=d?.value.trim()||"",!o.url)throw new Error("URL 欄位不可為空");const e=a?.value.trim()||"";e&&(o.headers=JSON.parse(e))}const e=l?.value.trim()||"";if("*"===e)o.tools=["*"];else if(e.startsWith("[")){if(o.tools=JSON.parse(e),!Array.isArray(o.tools))throw new Error("工具欄位必須是陣列格式")}else o.tools=["*"]}catch(e){const t=e;throw new Error(t.message.includes("JSON")?"JSON 格式錯誤："+t.message:t.message)}return o}var customForm=document.getElementById("customForm");customForm&&customForm.addEventListener("submit",function(e){e.preventDefault();try{const e=buildConfigFromForm(),t=document.getElementById("customName"),o=document.getElementById("customDescription");if(null!==editingPresetId)presetOverrides[editingPresetId]=e,saveState(),updateJsonOutput(),closeCustomModal();else{const n=t?.value.trim()||"",s={name:n,description:o?.value.trim()||"",config:e};null!==editingCustomId?customConfigs[editingCustomId]=s:customConfigs.push(s),saveState(),renderCustomConfigs(),updateJsonOutput(),closeCustomModal()}t&&(t.disabled=!1),o&&(o.disabled=!1)}catch(e){const t=e;let o="設定錯誤";t.message.includes("JSON")?o+="：JSON 格式錯誤，請檢查 JSON 欄位的格式":o+="："+t.message,alert(o)}}),document.addEventListener("keydown",function(e){if(isCustomModalOpen()&&!e.isComposing)return"Escape"===e.key?(e.preventDefault(),void closeCustomModal()):void("Enter"!==e.key||!e.ctrlKey&&!e.metaKey||e.shiftKey||e.altKey||(e.preventDefault(),saveCustomModal()))});var jsonOutput=document.getElementById("jsonOutput");function fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback copy failed:",e)}document.body.removeChild(t)}jsonOutput&&jsonOutput.addEventListener("input",function(){const e=this;try{applyStateFromJsonText(e.value),e.classList.remove("is-invalid"),saveState(),renderPresets(),renderCustomConfigs()}catch(t){e.classList.add("is-invalid")}}),window.copyPath=function(e,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{t&&(t.classList.add("copied"),setTimeout(()=>{t.classList.remove("copied")},500))}).catch(t=>{console.error("Failed to copy:",t),fallbackCopy(e)}):fallbackCopy(e)},window.copyCodeBlock=function(){const e=document.querySelector(".notice-content pre code");if(!e)return void console.error("Code block not found");const t=e.textContent||"";navigator.clipboard.writeText(t).then(()=>{const e=document.querySelector(".copy-code-btn");if(!e)return void console.error("Copy button not found");const t=e.innerHTML;e.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <polyline points="20 6 9 17 4 12"></polyline>\n            </svg>\n        ',e.style.color="#28a745",setTimeout(()=>{e.innerHTML=t,e.style.color=""},2e3)}).catch(e=>{console.error("Failed to copy:",e),alert("複製失敗，請手動複製")})},init();