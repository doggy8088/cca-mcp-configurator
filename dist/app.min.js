const PRESETS=[{id:"playwright",name:"Playwright MCP",description:"瀏覽器自動化工具，可用於網頁測試和互動",config:{type:"local",command:"npx",args:["@playwright/mcp@latest","--allowed-hosts","*"],tools:["*"]}},{id:"github",name:"GitHub MCP",description:"GitHub API 整合，可操作儲存庫、Issues、PR 等",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-github"],env:{GITHUB_PERSONAL_ACCESS_TOKEN:"<YOUR_TOKEN>"},tools:["*"]}},{id:"filesystem",name:"Filesystem MCP",description:"檔案系統操作，讀寫檔案和目錄",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-filesystem","/path/to/allowed/directory"],tools:["*"]}},{id:"brave-search",name:"Brave Search MCP",description:"網路搜尋功能，使用 Brave Search API",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-brave-search"],env:{BRAVE_API_KEY:"<YOUR_API_KEY>"},tools:["*"]}},{id:"puppeteer",name:"Puppeteer MCP",description:"另一個瀏覽器自動化工具，基於 Chrome",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-puppeteer"],tools:["*"]}},{id:"sqlite",name:"SQLite MCP",description:"SQLite 資料庫操作",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-sqlite","/path/to/database.db"],tools:["*"]}},{id:"fetch",name:"Fetch MCP",description:"HTTP 請求工具，可抓取網頁內容",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-fetch"],tools:["*"]}},{id:"git",name:"Git MCP",description:"Git 版本控制操作",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-git"],tools:["*"]}},{id:"sequential-thinking",name:"Sequential Thinking MCP",description:"增強推理能力，支援複雜思考過程",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-sequential-thinking"],tools:["*"]}},{id:"memory",name:"Memory MCP",description:"持久化記憶，跨對話保存資訊",config:{type:"local",command:"npx",args:["-y","@modelcontextprotocol/server-memory"],tools:["*"]}}];let selectedPresets=new Set,customConfigs=[],editingCustomId=null;function escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function init(){loadState(),renderPresets(),renderCustomConfigs(),updateJsonOutput()}function loadState(){const e=localStorage.getItem("mcpConfig");if(e)try{const t=JSON.parse(e);selectedPresets=new Set(t.selectedPresets||[]),customConfigs=t.customConfigs||[]}catch(e){console.error("Failed to load saved state:",e)}}function saveState(){const e={selectedPresets:Array.from(selectedPresets),customConfigs:customConfigs};localStorage.setItem("mcpConfig",JSON.stringify(e))}function renderPresets(){document.getElementById("presetList").innerHTML=PRESETS.map(e=>`\n                <div class="preset-item ${selectedPresets.has(e.id)?"selected":""}" id="preset-${e.id}">\n                    <div class="preset-header" onclick="togglePreset('${e.id}')">\n                        <input type="checkbox" ${selectedPresets.has(e.id)?"checked":""} onclick="event.stopPropagation(); togglePreset('${e.id}')">\n                        <span class="preset-name">${e.name}</span>\n                    </div>\n                    <div class="preset-description">${e.description}</div>\n                </div>\n            `).join("")}function togglePreset(e){selectedPresets.has(e)?selectedPresets.delete(e):selectedPresets.add(e),saveState(),renderPresets(),updateJsonOutput()}function renderCustomConfigs(){const e=document.getElementById("customList");0!==customConfigs.length?e.innerHTML=customConfigs.map((e,t)=>`\n                <div class="custom-item">\n                    <div class="custom-item-info">\n                        <div class="custom-item-name">${escapeHtml(e.name)}</div>\n                        ${e.description?`<div style="font-size: 0.9em; color: #666;">${escapeHtml(e.description)}</div>`:""}\n                    </div>\n                    <div class="custom-item-actions">\n                        <button class="small secondary" onclick="editCustom(${t})">編輯</button>\n                        <button class="small danger" onclick="deleteCustom(${t})">刪除</button>\n                    </div>\n                </div>\n            `).join(""):e.innerHTML='<div class="empty-state">尚無自訂設定</div>'}function updateJsonOutput(){const e={};selectedPresets.forEach(t=>{const o=PRESETS.find(e=>e.id===t);o&&(e[o.id]=o.config)}),customConfigs.forEach(t=>{e[t.name]=t.config});const t={mcpServers:e};document.getElementById("jsonOutput").textContent=JSON.stringify(t,null,2)}function openAddCustomModal(){editingCustomId=null,document.getElementById("modalTitle").textContent="新增自訂設定",document.getElementById("customForm").reset(),document.getElementById("customModal").classList.add("show")}function closeCustomModal(){document.getElementById("customModal").classList.remove("show"),editingCustomId=null}function editCustom(e){editingCustomId=e;const t=customConfigs[e];document.getElementById("modalTitle").textContent="編輯自訂設定",document.getElementById("customName").value=t.name,document.getElementById("customDescription").value=t.description||"",document.getElementById("customConfig").value=JSON.stringify(t.config,null,2),document.getElementById("customModal").classList.add("show")}function deleteCustom(e){confirm("確定要刪除這個自訂設定嗎？")&&(customConfigs.splice(e,1),saveState(),renderCustomConfigs(),updateJsonOutput())}function copyToClipboard(){const e=document.getElementById("jsonOutput").textContent;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{alert("已複製到剪貼簿！")}).catch(t=>{console.error("Failed to copy:",t),fallbackCopy(e)}):fallbackCopy(e)}function fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("已複製到剪貼簿！")}catch(e){console.error("Fallback copy failed:",e),alert("複製失敗，請手動複製")}document.body.removeChild(t)}function exportConfig(){const e={selectedPresets:Array.from(selectedPresets),customConfigs:customConfigs},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="mcp-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}function importConfig(e){const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=function(e){try{const t=JSON.parse(e.target.result);if("object"!=typeof t||null===t)throw new Error("無效的設定檔格式");if(t.selectedPresets&&!Array.isArray(t.selectedPresets))throw new Error("selectedPresets 必須是陣列");if(t.customConfigs&&!Array.isArray(t.customConfigs))throw new Error("customConfigs 必須是陣列");if(t.customConfigs)for(const e of t.customConfigs)if(!e.name||!e.config)throw new Error("自訂設定缺少必要欄位 (name 或 config)");selectedPresets=new Set(t.selectedPresets||[]),customConfigs=t.customConfigs||[],saveState(),renderPresets(),renderCustomConfigs(),updateJsonOutput(),alert("匯入成功！")}catch(e){let t="匯入失敗";e.message.includes("JSON")?t+="：檔案格式錯誤，請確認是有效的 JSON 檔案":t+="："+e.message,alert(t)}},o.readAsText(t),e.target.value=""}document.getElementById("customForm").addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("customName").value.trim(),o=document.getElementById("customDescription").value.trim(),n=document.getElementById("customConfig").value.trim();try{const e={name:t,description:o,config:JSON.parse(n)};null!==editingCustomId?customConfigs[editingCustomId]=e:customConfigs.push(e),saveState(),renderCustomConfigs(),updateJsonOutput(),closeCustomModal()}catch(e){let t="JSON 格式錯誤";e.message.includes("Unexpected token")?t+="：語法錯誤，請檢查是否有缺少逗號、括號或引號":e.message.includes("Unexpected end")?t+="：JSON 不完整，請檢查是否有未關閉的括號":t+="："+e.message,alert(t)}}),document.getElementById("customModal").addEventListener("click",function(e){e.target===this&&closeCustomModal()}),init();